<div class="content" role="main">
    <section class="hero">
        <div class="container">
            <div class="row align-items-center justify-content-center text-center">
                <div class="col-sm-4 col-5 mb30">
                    <label class="mb0" style="color: #1AD9C6;">Supply Balance</label>
                    <div class="supply-balance">${{toDecimal(totalSupplyBalance, 7)}}</div>
                    <div class="d-block d-sm-none">
                        <label class="color-danger mb0">Borrow Balance</label>
                        <div class="borrow-balance">$0.0000</div>
                    </div>
                </div>
                <div class="col-sm-4 col-7 mb30">
                    <div class="progress-circle--container">
                        <div class="progress progress-circle" data-percentage="100">
                            <span class="progress-left">
                                <span class="progress-bar"></span>
                            </span>
                            <span class="progress-right">
                                <span class="progress-bar"></span>
                            </span>
                            <div class="progress-value">
                                <div>
                                    <span>Net APY</span>
                                    {{toDecimal(apyData.netApy, 2)}}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-4 col-5 mb30 d-none d-sm-block">
                    <label class="color-danger mb0">Borrow Balance</label>
                    <div class="borrow-balance">${{toDecimal(totalBorrowBalance, 7)}}</div>
                </div>
            </div>
            <div>
                <div class="progress-bar--container mb20">
                    <label class="progress-title">Borrow&nbsp;Limit</label>
                    <label class="progress-percent mr10">{{toDecimal(sliderPercentage, 2)}}%</label>
                    <div class="progress progress-sm">
                        <div class="progress-bar progress-success" role="progressbar"
                            style="width: {{ sliderPercentage }}%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <label class="ml10">${{ toDecimal(accountLiquidity, 2) }}</label>
                </div>
            </div>
        </div>
    </section>
    <section>
        <div class="container-lg">
            <div class="row">
                <div class="col-md-6">
                    <div class="portlet portlet--height-full">
                        <div class="portlet__head">
                            <div class="portlet__head-caption">
                                <div class="portlet__head-title">
                                    <h3 class="portlet__head-text">Supply</h3>
                                </div>
                            </div>
                        </div>
                        <div class="portlet__body py0 px0">
                            <div class="asset-list">
                                <div class="labels row">
                                    <div class="col-sm-4 col-4">
                                        <label>Asset</label>
                                    </div>
                                    <div class="col-sm-3 col-4 text-right d-none d-sm-block">
                                        <label>APY</label>
                                    </div>
                                    <div class="col-sm-3 col-4 text-right">
                                        <label>Wallet</label>
                                    </div>
                                    <div class="col-sm-2 col-4 text-right">
                                        <label>Collateral</label>
                                    </div>
                                </div>
                                <div class="assets">
                                    <a class="asset" *ngFor="let token of assetTokenData; let i = index"
                                        (click)="openSupplyModal(token.id)">
                                        <div class="col-4 col-sm-4">
                                            <div class="balance">
                                                <img  style="max-height: 30px;" src="assets/img/ether_logo.svg" alt="Ether logo" />
                                                <div style="display: inline-block;">{{token.symbol}}</div>
                                                <span class="subtitle d-block d-sm-none">{{token.supplyApy}}%</span>
                                            </div>
                                        </div>
                                        <div class="col-sm-3 text-right d-none d-sm-block">
                                            <div class="balance">
                                                <div>{{token.supplyApy}}%</div>
                                            </div>
                                        </div>
                                        <div class="col-4 col-sm-3 text-right">
                                            <div class="balance">
                                                <div>{{ toDecimal(token.tokenBalance, 2) }}</div>
                                            </div>
                                        </div>
                                        <div class="col-4 col-sm-2 text-right">
                                            <mat-slide-toggle [checked]="token.enabled" [disabled]="false"
                                                (change)="enterExitMarket(token)">
                                            </mat-slide-toggle>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="portlet portlet--height-full">
                        <div class="portlet__head">
                            <div class="portlet__head-caption">
                                <div class="portlet__head-title">
                                    <h3 class="portlet__head-text">Available to Borrow</h3>
                                </div>
                            </div>
                        </div>
                        <div class="portlet__body py0 px0">
                            <div class="asset-list">
                                <div class="labels row">
                                    <div class="col-sm-4 col-4">
                                        <label>Asset</label>
                                    </div>
                                    <div class="col-sm-3 col-4 text-right d-none d-sm-block">
                                        <label>APY</label>
                                    </div>
                                    <div class="col-sm-3 col-4 text-right">
                                        <label>Wallet</label>
                                    </div>
                                    <div class="col-sm-2 col-4 text-right">
                                        <label>% Of Limit</label>
                                    </div>
                                </div>
                                <div class="assets">
                                    <a class="asset" *ngFor="let token of cashTokenData; let i = index"
                                        (click)="openBorrowModal(token.id)">
                                        <div class="col-4 col-sm-4">
                                            <div class="balance">
                                                <img src="assets/img/{{ token.symbol }}_logo.svg" alt="{{ token.symbol }} logo" class="token-logos" />
                                                <div style="display: inline-block;">{{token.symbol}}</div>
                                                <span class="subtitle d-block d-sm-none">{{token.borrowApy}}%</span>
                                            </div>
                                        </div>
                                        <div class="col-sm-3 text-right d-none d-sm-block">
                                            <div class="balance">
                                                <div>{{token.borrowApy}}%</div>
                                            </div>
                                        </div>
                                        <div class="col-4 col-sm-3 text-right">
                                            <div class="balance">
                                                <div>{{ toDecimal(token.tokenBalance, 3) }}</div>
                                            </div>
                                        </div>
                                        <div class="col-4 col-sm-2 text-right">
                                            0%
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<div *ngIf="loadComplete" class="modal fade" id="supplyModal" tabindex="-1" role="dialog" aria-labelledby="supplyModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content" style="background-color: #E6EDF6;">
            <div class="modal-body py0 px0">
                <div class="row my0 mx0">
                    <div class="col-lg-6 py0 px0" style="background-color: #fff;">
                        <div class="py15 px15 d-block d-lg-none">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="my20 mx15" id="supplyGroup" style="position: relative;">
                            <select id="supply" name="supply" class="select2-main" style="width: 100%;"></select>
                        </div>
                        <div class="d-none d-lg-block">
                        </div>
                        <div class="px15">
                            <div class="calculation">
                                <span class="description">Supply APY</span>
                                <span class="color-success">{{tokenData[selectedTokenIndex].supplyApy}}%</span>
                            </div>
                            <div class="calculation">
                                <span class="description">Price</span>
                                <span>$ {{tokenData[selectedTokenIndex].priceUsd}}</span>
                            </div>
                            <div class="calculation">
                                <span class="description">Collateral Factor</span>
                                <span>{{tokenData[selectedTokenIndex].collateralFactor}}%</span>
                            </div>
                            <div class="calculation">
                                <span class="description">Wallet</span>
                                <span>{{toDecimal(tokenData[selectedTokenIndex].tokenBalance, 2)}}
                                    {{ tokenData[selectedTokenIndex].symbol }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 py0 px0">
                        <div class="py15 px15">
                            <button type="button" class="close d-none d-lg-block" data-dismiss="modal"
                                aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <div class="form" *ngIf="tokenData[selectedTokenIndex].approved">
                                <div class="row">
                                    <div class="col-6">
                                        <button [ngClass]="{'active': typeViewSupply == 'withdraw'}"
                                            class="btn btn-lg btn-full btn-secondary"
                                            (click)="viewWithdrawForm()">Withdraw</button>
                                    </div>
                                    <div class="col-6">
                                        <button [ngClass]="{'active': typeViewSupply == 'supply'}"
                                            class="btn btn-lg btn-full btn-secondary"
                                            (click)="viewSupplyForm()">Supply</button>
                                    </div>
                                </div>
                                <div class="my30">
                                    <form>
                                        <div class="row align-items-center">
                                            <div class="col-12">
                                                <input type="text" class="form-control form-control-lg text-center"
                                                    placeholder="0" [(ngModel)]="amountInput" name="amountInput">
                                            </div>
                                            <!-- <div class="col-3 text-center">
                          <a href="" class="link">
                            SAFE MAX
                          </a>
                        </div> -->
                                        </div>
                                    </form>
                                    <div class="mt30">
                                        <div class="calculation">
                                            <span class="description">Supply Balance</span>
                                            <span>
                                                ${{toDecimal(tokenData[selectedTokenIndex].cTokenSupplyBalance, 3)}}
                                                <!-- <mat-icon aria-hidden="false">arrow_forward</mat-icon>
                          $0.00 -->
                                            </span>
                                        </div>
                                        <div class="calculation">
                                            <span class="description">Borrow Limit</span>
                                            <span>
                                                $ {{ toDecimal(accountLiquidity, 2) }}
                                                <!-- <mat-icon aria-hidden="false">arrow_forward</mat-icon>
                          $0.00 -->
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-lg btn-full btn-secondary" (click)="withdrawUnderlying()"
                                        *ngIf="typeViewSupply == 'withdraw'">Withdraw</button>
                                    <button class="btn btn-lg btn-full btn-secondary" (click)="mint()"
                                        *ngIf="typeViewSupply == 'supply'">Supply</button>
                                </div>
                            </div>
                            <div class="form mt100" *ngIf="!tokenData[selectedTokenIndex].approved">
                                <div class="text-center">
                                    <mat-icon style="font-size: 3rem;" aria-hidden="false">error_outline</mat-icon>
                                </div>
                                <div class="mt20 mb30" style="font-weight: 500;">
                                    To use {{tokenData[selectedTokenIndex].symbol}} with the Konkrete, you need to enable
                                    it first.
                                </div>
                                <button class="btn btn-lg btn-full btn-secondary"
                                    (click)="enableSupplyCollateral()">Enable</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div *ngIf="loadComplete" class="modal fade" id="borrowModal" tabindex="-1" role="dialog" aria-labelledby="borrowModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content" style="background-color: #E6EDF6;">
            <div class="modal-body py0 px0">
                <div class="row my0 mx0">
                    <div class="col-lg-6 py0 px0" style="background-color: #fff;">
                        <div class="py15 px15 d-block d-lg-none">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="my20 mx15" id="borrowGroup" style="position: relative;">
                            <select id="borrow" name="borrow" class="select2-main" style="width: 100%;"></select>
                        </div>
                        <div class="d-none d-lg-block">
                        </div>
                        <div class="px15">
                            <div class="calculation">
                                <span class="description">Borrow APY</span>
                                <span class="color-danger">{{tokenData[selectedTokenIndex].borrowApy}}%</span>
                            </div>
                            <div class="calculation">
                                <span class="description">Price</span>
                                <span>$ {{tokenData[selectedTokenIndex].priceUsd}}</span>
                            </div>
                            <div class="calculation">
                                <span class="description">Borrow Balance</span>
                                <span>{{toDecimal((tokenData[selectedTokenIndex].tokenBorrowBalance), 2)}}
                                    {{ tokenData[selectedTokenIndex].symbol }}</span>
                            </div>
                            <div class="calculation">
                                <span class="description">Wallet</span>
                                <span>{{toDecimal(tokenData[selectedTokenIndex].tokenBalance, 2)}}
                                    {{ tokenData[selectedTokenIndex].symbol }}</span>
                            </div>
                            <div class="calculation">
                                <span class="description">Available to Borrow</span>
                                <span>{{toDecimal(tokenData[selectedTokenIndex].availableBorrow, 2)}}
                                    {{ tokenData[selectedTokenIndex].symbol }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 py0 px0">
                        <div class="py15 px15">
                            <button type="button" class="close d-none d-lg-block" data-dismiss="modal"
                                aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <div class="form" *ngIf="tokenData[selectedTokenIndex].approved">
                                <div class="row">
                                    <div class="col-6">
                                        <button [ngClass]="{'active': typeViewBorrow == 'repay'}"
                                            class="btn btn-lg btn-full btn-danger"
                                            (click)="viewRepayForm()">Repay</button>
                                    </div>
                                    <div class="col-6">
                                        <button [ngClass]="{'active': typeViewBorrow == 'borrow'}"
                                            class="btn btn-lg btn-full btn-danger"
                                            (click)="viewBorrowForm()">Borrow</button>
                                    </div>
                                </div>
                                <div class="my30">
                                    <form>
                                        <div class="row align-items-center">
                                            <div class="col-12">
                                                <input type="text" class="form-control form-control-lg text-center"
                                                    placeholder="0" [(ngModel)]="amountInput" name="amountInput">
                                            </div>
                                            <!-- <div class="col-3 text-center">
                          <a href="" class="link">
                            SAFE MAX
                          </a>
                        </div> -->
                                        </div>
                                    </form>
                                    <div class="mt30">
                                        <div class="calculation">
                                            <span class="description">Borrow Limit</span>
                                            <span>$ {{ toDecimal(accountLiquidity, 2) }}</span>
                                        </div>
                                        <div class="calculation">
                                            <span class="description">Borrow Balance</span>
                                            <span>$ {{toDecimal(totalBorrowBalance, 3)}}</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-lg btn-full btn-danger" (click)="repayBorrow()"
                                        *ngIf="typeViewBorrow == 'repay'">Repay</button>
                                    <button class="btn btn-lg btn-full btn-danger" (click)="borrow()"
                                        *ngIf="typeViewBorrow == 'borrow'">Borrow</button>
                                </div>
                            </div>
                            <div class="form mt100" *ngIf="!tokenData[selectedTokenIndex].approved">
                                <div class="text-center">
                                    <mat-icon style="font-size: 3rem;" aria-hidden="false">error_outline</mat-icon>
                                </div>
                                <div class="mt20 mb30" style="font-weight: 500;">
                                    To use {{tokenData[selectedTokenIndex].symbol}} with the Konkrete, you need to enable
                                    it first.
                                </div>
                                <button class="btn btn-lg btn-full btn-danger"
                                    (click)="enableBorrowCollateral()">Enable</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="noMetaMaskModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog"
    aria-labelledby="noMetaMaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="py30">
                    <h2>Metamask Not Found!</h2>
                    <p class="lead">Connection to Blockchain could not be established. Please install Metamask plugin
                        for your browser from <a href="https://metamask.io/" target="_blank">metamask.io</a> and then
                        try again.</p>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="metaMaskRejectModal" data-backdrop="static" data-keyboard="false" tabindex="-1"
    role="dialog" aria-labelledby="metaMaskRejectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="py30">
                    <h2>Metamask Connection Denied!</h2>
                    <p class="lead">Please Accept Metamask Connection Request.</p>
                    <button class="btn btn-primary" (click)="reloadPage()">Try Again</button>
                </div>
            </div>
        </div>
    </div>
</div>
